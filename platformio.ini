; AVAILABLE ENVIRONMENTS:
; ├── esp32dev      - USB upload (default)
; ├── esp32dev-ota  - Over-the-air WiFi upload
; └── esp32dev-ci   - Build/test only (CI/CD)
;
; QUICK COMMANDS:
; pio run                              # Build default environment
; pio run --target upload              # Upload to default environment
; pio run -e esp32dev-ota --target upload  # OTA upload via WiFi
; pio run -e esp32dev-ci               # CI build (no upload)

[platformio]
default_envs = esp32dev
extra_configs = platformio_credentials.ini

[env:esp32dev]
; Build: pio run -e esp32dev
; Upload: pio run -e esp32dev --target upload
; Monitor: pio device monitor -e esp32dev
platform = espressif32@5.4.0
board = esp32dev
framework = arduino

lib_deps =
    adafruit/Adafruit Protomatter@^1.6.4
    adafruit/RTClib@^2.1.4
    wire
    WiFi
    ArduinoOTA
    ESPmDNS
    bblanchon/ArduinoJson@^6.19.4

monitor_speed = 9600
upload_speed = 115200

build_flags =
    -DMONITOR_SPEED=${env:esp32dev.monitor_speed}

monitor_filters =
    default
    time

upload_protocol = esptool
; upload_port = auto

[env:esp32dev-ota]
; Build: pio run -e esp32dev-ota
; Upload: pio run -e esp32dev-ota --target upload (requires WiFi connection)
; Monitor: pio device monitor -e esp32dev-ota
platform = espressif32@5.4.0
board = esp32dev
framework = arduino

lib_deps =
    adafruit/Adafruit Protomatter@^1.6.4
    adafruit/RTClib@^2.1.4
    wire
    WiFi
    ArduinoOTA
    ESPmDNS
    bblanchon/ArduinoJson@^6.19.4

monitor_speed = 9600
upload_speed = 115200

build_flags =
    -DMONITOR_SPEED=${env:esp32dev-ota.monitor_speed}

monitor_filters =
    default
    time

; OTA upload configuration
; To use OTA:
; 1. Uncomment extra_configs line in [platformio] section ✓ DONE
; 2. Uncomment the upload lines below ✓ DONE
; 3. Ensure platformio_credentials.ini exists with [ota_credentials] section ✓ EXISTS
upload_protocol = espota
upload_port = ${ota_credentials.upload_port}
upload_flags = --auth=${ota_credentials.auth_password}

[env:esp32dev-ci]
; Build: pio run -e esp32dev-ci (build only, no upload)
; Test: pio test -e esp32dev-ci
; Check: pio check -e esp32dev-ci
platform = espressif32@5.4.0
board = esp32dev
framework = arduino

lib_deps =
    adafruit/Adafruit Protomatter@^1.6.4
    adafruit/RTClib@^2.1.4
    wire
    WiFi
    ArduinoOTA
    ESPmDNS
    bblanchon/ArduinoJson@^6.19.4

monitor_speed = 9600
upload_speed = 115200

build_flags =
    -DMONITOR_SPEED=${env:esp32dev-ci.monitor_speed}

monitor_filters =
    default
    time

; CI environment - no upload, just build
upload_protocol = esptool
